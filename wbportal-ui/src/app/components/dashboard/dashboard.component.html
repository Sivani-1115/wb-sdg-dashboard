<div class="dashboard-container">
  <!-- Header -->
  <header class="dashboard-header">
    <div class="header-content">
      <div class="logo-section">
        <div class="wb-logo">
          <svg
            width="40"
            height="40"
            viewBox="0 0 60 60"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <circle cx="30" cy="30" r="30" fill="#1E3A8A" />
            <path d="M30 10L40 25H35V45H25V25H20L30 10Z" fill="white" />
            <path d="M15 35H45V40H15V35Z" fill="white" />
          </svg>
        </div>
        <h1>World Bank SDG Dashboard</h1>
      </div>
      <div class="user-section">
        <div class="user-profile">
          <div class="user-avatar">
            <span>{{
              (authService.currentUser$ | async)?.username?.charAt(0)?.toUpperCase() || 'U'
            }}</span>
          </div>
          <div class="user-details">
            <span class="user-name">{{
              (authService.currentUser$ | async)?.username || 'User'
            }}</span>
            <span class="user-role">{{ (authService.currentUser$ | async)?.role || 'User' }}</span>
          </div>
        </div>
        <button class="logout-button" (click)="logout()">
          <svg
            width="16"
            height="16"
            viewBox="0 0 24 24"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M17 7L7 17M7 7L17 17M12 3C7.02944 3 3 7.02944 3 12C3 16.9706 7.02944 21 12 21C16.9706 21 21 16.9706 21 12C21 7.02944 16.9706 3 12 3Z"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            />
          </svg>
          Logout
        </button>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="dashboard-main">
    @if (isLoading()) {
    <div class="loading-container">
      <div class="spinner"></div>
      <p>Loading dashboard data...</p>
    </div>
    } @else if (errorMessage()) {
    <div class="error-container">
      <p>{{ errorMessage() }}</p>
      <button (click)="loadDashboardData()">Retry</button>
    </div>
    } @else {
    <!-- Stats Cards -->
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-icon projects-icon">üìä</div>
        <div class="stat-content">
          <h3>{{ projectStats().totalProjects }}</h3>
          <p>Total Projects</p>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon active-icon">üöÄ</div>
        <div class="stat-content">
          <h3>{{ projectStats().activeProjects }}</h3>
          <p>Active Projects</p>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon completed-icon">‚úÖ</div>
        <div class="stat-content">
          <h3>{{ projectStats().closedProjects }}</h3>
          <p>Closed Projects</p>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon feedback-icon">üí∞</div>
        <div class="stat-content">
          <h3>{{ formatLargeNumber(projectStats().totalCommitment) }}</h3>
          <p>Total Commitment</p>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon rating-icon">‚≠ê</div>
        <div class="stat-content">
          <h3>{{ projectStats().averageSDGScore }}%</h3>
          <p>Avg SDG Score</p>
        </div>
      </div>
    </div>

    <!-- Quick Actions -->
    <div class="quick-actions">
      <h2>Quick Actions</h2>
      <div class="action-buttons">
        <button class="action-button primary" (click)="goToProjects()">
          <span class="button-icon">üìã</span>
          Manage Projects
        </button>
        <button class="action-button secondary" (click)="goToFeedbacks()">
          <span class="button-icon">üí≠</span>
          View Feedbacks
        </button>
      </div>
    </div>

    <!-- World Bank Projects -->
    <div class="recent-section">
      <h2>World Bank SDG Projects</h2>
      @if (projects().length === 0) {
      <div class="empty-state">
        <p>No projects found. Create your first project to get started!</p>
      </div>
      } @else {
      <div class="projects-grid">
        @for (project of projects().slice(0, 4); track project.id) {
        <div class="project-card">
          <div class="project-header">
            <h3>{{ project.projectTitle }}</h3>
            <span class="status-badge" [style.background-color]="getStatusColor(project.status)">
              {{ project.status }}
            </span>
          </div>
          <div class="project-country">
            <span class="country-flag">üåç</span>
            <span class="country-name">{{ project.country }}</span>
            <span class="project-id">ID: {{ project.projectId }}</span>
          </div>
          <div class="project-details">
            <div class="detail-item">
              <span class="detail-label">Commitment:</span>
              <span class="detail-value">{{ formatLargeNumber(project.commitmentAmount) }}</span>
            </div>
            <div class="detail-item">
              <span class="detail-label">Approval Date:</span>
              <span class="detail-value">{{ formatDate(project.approvalDate) }}</span>
            </div>
            <div class="detail-item">
              <span class="detail-label">Last Updated:</span>
              <span class="detail-value">{{ formatDate(project.lastUpdatedDate) }}</span>
            </div>
            <div class="detail-item">
              <span class="detail-label">Stage:</span>
              <span class="detail-value">{{ project.lastStageReached }}</span>
            </div>
          </div>

          @if (project.sdgScores && project.sdgScores.length > 0) {
          <div class="sdg-preview">
            <h4>SDG Performance</h4>
            <div class="sdg-scores-mini">
              @for (score of project.sdgScores.slice(0, 3); track score.sdgNumber) {
              <div class="sdg-mini-item">
                <span class="sdg-number">SDG {{ score.sdgNumber }}</span>
                <div class="mini-score-bar">
                  <div
                    class="mini-score-fill"
                    [style.width.%]="score.score"
                    [style.background-color]="getScoreColor(score.score)"
                  ></div>
                </div>
                <span class="mini-score">{{ score.score }}%</span>
              </div>
              }
            </div>
            <button class="view-details-btn" (click)="viewProjectDetails(project)">
              View Full SDG Analysis
            </button>
          </div>
          }
        </div>
        }
      </div>
      }
    </div>

    <!-- Recent Feedbacks -->
    <div class="recent-section">
      <h2>Recent Feedbacks</h2>
      @if (feedbacks().length === 0) {
      <div class="empty-state">
        <p>No feedbacks yet. Encourage team members to share their thoughts!</p>
      </div>
      } @else {
      <div class="feedbacks-list">
        @for (feedback of feedbacks().slice(0, 5); track feedback.id) {
        <div class="feedback-card">
          <div class="feedback-header">
            <div class="feedback-rating">
              @for (star of [1,2,3,4,5]; track star) {
              <span class="star" [class.filled]="star <= feedback.rating">‚≠ê</span>
              }
            </div>
            <span class="feedback-date">{{ formatDate(feedback.createdAt) }}</span>
          </div>
          <p class="feedback-content">{{ feedback.content }}</p>
          @if (feedback.user) {
          <div class="feedback-author">By: {{ feedback.user.username }}</div>
          }
        </div>
        }
      </div>
      }
    </div>
    }
  </main>
</div>
